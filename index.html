<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bankroll Manager</title>

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/layout.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/modal.css">
  <link rel="stylesheet" href="assets/css/pages/dashboard.css">
</head>
<body>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <h1 class="logo">Bankroll</h1>

    <button id="open-bet-modal" class="btn btn-primary add-bet-btn">
      + ADICIONAR APOSTA
    </button>

    <nav class="nav">
      <a href="#" class="nav-link active">Dashboard</a>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <header class="header">
      <h2>Dashboard</h2>
      <button class="btn btn-ghost" id="reset-btn">Reset</button>
    </header>

    <section class="stats">
      <div class="card stat">
        <span class="stat-label">Banca Atual</span>
        <strong class="stat-value bank" id="bank-value">€0</strong>
      </div>

      <div class="card stat">
        <span class="stat-label">Lucro</span>
        <strong class="stat-value profit" id="profit-value">€0</strong>
      </div>

      <div class="card stat">
        <span class="stat-label">ROI</span>
        <strong class="stat-value roi" id="roi-value">0%</strong>
      </div>
    </section>

    <section class="content">
      <div class="card">
        <h3>Evolução da Banca</h3>
        <canvas id="bank-chart" class="chart-placeholder"></canvas>
      </div>
    </section>

  </main>
</div>

<!-- MODAL -->
<div id="bet-modal" class="modal hidden">
  <div class="modal-content">
    <header class="modal-header">
      <h3>Adicionar Aposta</h3>
      <button id="close-bet-modal" class="btn btn-ghost">X</button>
    </header>

    <form id="bet-form" class="modal-form">

      <div class="form-group">
        <label class="label">Stake (€)</label>
        <input class="input" type="number" id="stake" required>
      </div>

      <div class="form-group">
        <label class="label">Odds</label>
        <input class="input" type="number" step="0.01" id="odds" required>
      </div>

      <div class="form-group">
        <label class="label">Mercado</label>
        <input class="input" type="text" id="market" placeholder="Ex: Over 2.5 Golos" required>
      </div>

      <div class="form-group">
        <label class="label">Casa de Aposta</label>
        <input class="input" type="text" id="bookmaker" placeholder="Ex: Bet365" required>
      </div>

      <div class="form-group">
        <label class="label">Resultado</label>
        <select class="input" id="result" required>
          <option value="win">Win</option>
          <option value="loss">Loss</option>
          <option value="void">Void</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">
        Guardar Aposta
      </button>

    </form>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let bankroll = parseFloat(localStorage.getItem('bankroll')) || 1000;
let bets = JSON.parse(localStorage.getItem('bets')) || [];
let chart;

updateStats();
renderChart();

/* MODAL */
const modal = document.getElementById('bet-modal');
document.getElementById('open-bet-modal').onclick = () => modal.classList.remove('hidden');
document.getElementById('close-bet-modal').onclick = () => modal.classList.add('hidden');
modal.onclick = e => { if(e.target === modal) modal.classList.add('hidden'); };

/* RESET */
document.getElementById('reset-btn').onclick = () => {
  if(confirm('Resetar banca e apostas?')) {
    bankroll = 1000;
    bets = [];
    saveData();
    updateStats();
    renderChart();
  }
};

/* ADD BET */
document.getElementById('bet-form').onsubmit = e => {
  e.preventDefault();

  const stake = +document.getElementById('stake').value;
  const odds = +document.getElementById('odds').value;
  const market = document.getElementById('market').value;
  const bookmaker = document.getElementById('bookmaker').value;
  const result = document.getElementById('result').value;

  if(stake <= 0 || odds < 1.01) {
    alert('Valores inválidos');
    return;
  }

  let profit = 0;
  if(result === 'win') profit = stake * (odds - 1);
  if(result === 'loss') profit = -stake;

  bets.push({ stake, odds, market, bookmaker, result, profit });
  bankroll += profit;

  saveData();
  updateStats();
  renderChart();

  e.target.reset();
  modal.classList.add('hidden');
};

function updateStats() {
  const totalProfit = bets.reduce((s,b)=>s+b.profit,0);
  const totalStake = bets.reduce((s,b)=>s+b.stake,0);
  const roi = totalStake ? ((totalProfit/totalStake)*100).toFixed(2) : 0;

  document.getElementById('bank-value').textContent = `€${bankroll.toFixed(2)}`;
  document.getElementById('profit-value').textContent = `€${totalProfit.toFixed(2)}`;
  document.getElementById('roi-value').textContent = `${roi}%`;
}

function saveData() {
  localStorage.setItem('bankroll', bankroll);
  localStorage.setItem('bets', JSON.stringify(bets));
}

function renderChart() {
  const ctx = document.getElementById('bank-chart').getContext('2d');
  if(chart) chart.destroy();

  let value = 1000;
  const data = bets.map(b => value += b.profit);

  chart = new Chart(ctx,{
    type:'line',
    data:{ labels:data.map((_,i)=>`Aposta ${i+1}`), datasets:[{
      data,
      fill:true,
      borderColor:'#38bdf8',
      backgroundColor:'rgba(56,189,248,0.2)',
      tension:0.3
    }]},
    options:{ responsive:true, plugins:{ legend:{ display:false }}}
  });
}
</script>

</body>
</html>
